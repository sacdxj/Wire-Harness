---
import MainLayout from '../layouts/MainLayout.astro';
import Breadcrumb from '../components/Breadcrumb.astro';

const breadcrumbItems = [
  { name: 'Home', href: '/' },
  { name: 'Contact', href: '/contact' }
];

// ‰ªéÁéØÂ¢ÉÂèòÈáèËé∑ÂèñÈÖçÁΩÆ
const formspreeId = import.meta.env.PUBLIC_FORMSPREE_ID || 'mpqjalap';
const contactEmail = import.meta.env.PUBLIC_CONTACT_EMAIL || 'Gben@trycay.com';
const contactPhone = import.meta.env.PUBLIC_CONTACT_PHONE || '+8618928435743';

// Turnstile Site Key - Hardcoded to avoid Vercel env var issues
const turnstileSiteKey = '0x4AAAAAACZHu4EQr9mekXHj';
const enableTurnstile = true;
---

<MainLayout
  title="Request Terminal Wire Assembly Quote | Upload Drawings"
  description="Get a custom terminal wire assembly quote within 24 hours. Upload your drawings, specifications, and connector requirements for rapid prototyping and volume production."
>
  <!-- Contact Page Schema -->
  <script type="application/ld+json" set:html={JSON.stringify({
    "@context": "https://schema.org",
    "@type": "ContactPage",
    "name": "Contact Trycay - Request Wire Assembly Quote",
    "description": "Get a custom terminal wire assembly quote within 24 hours",
    "mainEntity": {
      "@type": "Organization",
      "name": "Trycay",
      "url": "https://trycay.com",
      "contactPoint": [
        {
          "@type": "ContactPoint",
          "contactType": "sales",
          "email": contactEmail,
          "availableLanguage": ["English", "Chinese"],
          "contactOption": "TollFree"
        },
        {
          "@type": "ContactPoint",
          "contactType": "customer service",
          "telephone": "+86-189-2843-5743",
          "availableLanguage": ["English", "Chinese"],
          "contactOption": "TollFree"
        },
        {
          "@type": "ContactPoint",
          "contactType": "technical support",
          "email": contactEmail,
          "availableLanguage": ["English", "Chinese"]
        }
      ],
      "address": {
        "@type": "PostalAddress",
        "addressCountry": "CN",
        "addressRegion": "Guangdong"
      }
    },
    "about": {
      "@type": "Service",
      "name": "Custom Wire Assembly Quote Service",
      "description": "Request quotes for custom terminal wire assemblies, rapid prototyping, and volume production",
      "provider": {
        "@type": "Organization",
        "name": "Trycay",
        "url": "https://trycay.com"
      }
    }
  })} />

  <Breadcrumb items={breadcrumbItems} />

  <section class="px-4 py-20 relative overflow-hidden">
    <!-- Subtle background pattern -->
    <div class="absolute inset-0 opacity-[0.02]" style="background-image: radial-gradient(circle at 1px 1px, theme('colors.accent-cyan') 1px, transparent 0); background-size: 40px 40px;"></div>

    <div class="max-w-7xl mx-auto relative z-10">
      <!-- Hero Image -->
      <div class="mb-12 rounded-lg overflow-hidden border border-border shadow-2xl shadow-accent-cyan/10 group">
        <div class="absolute inset-0 bg-gradient-to-r from-accent-cyan/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-500"></div>
        <img
          src="/images/contact/customer-service.jpg"
          alt="Engineering Support Team"
          class="w-full h-64 object-cover"
          loading="lazy"
        />
      </div>

      <div class="text-center mb-12">
        <div class="inline-flex items-center gap-3 mb-6">
          <div class="h-px w-12 bg-gradient-to-r from-transparent via-accent-cyan to-transparent"></div>
          <span class="font-mono text-xs text-accent-cyan uppercase tracking-[0.2em] font-semibold">Get a Quote</span>
          <div class="h-px w-12 bg-gradient-to-r from-transparent via-accent-cyan to-transparent"></div>
        </div>
        <h1 class="text-4xl md:text-5xl font-bold tracking-tight mb-6 bg-gradient-to-r from-text-primary via-text-secondary to-text-secondary bg-clip-text text-transparent">
          Upload Your Assembly Drawing
        </h1>
        <p class="text-lg text-text-secondary max-w-2xl mx-auto">
          Share your terminal wire assembly specifications. Our engineering team will respond within 24 hours with pricing and lead time.
        </p>

        <!-- Trust badges -->
        <div class="flex flex-wrap justify-center gap-6 mt-8">
          <div class="flex items-center gap-2 text-sm text-text-secondary">
            <span class="w-2 h-2 rounded-full bg-accent-green animate-pulse"></span>
            <span>24-Hour Response</span>
          </div>
          <div class="flex items-center gap-2 text-sm text-text-secondary">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
            <span>ISO 9001:2015</span>
          </div>
          <div class="flex items-center gap-2 text-sm text-text-secondary">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
            <span>UL Certified</span>
          </div>
        </div>
      </div>

      <!-- Contact Form (Full Width) -->
      <div class="max-w-4xl mx-auto mb-12">
          <form
            action={`https://formspree.io/f/${formspreeId}`}
            method="POST"
            class="bg-bg-secondary/80 backdrop-blur border border-border p-8 shadow-lg shadow-accent-cyan/5 hover:shadow-accent-cyan/10 transition-shadow duration-500"
          >
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
              <div>
                <label for="name" class="block font-mono text-xs text-text-muted uppercase tracking-wider mb-2">
                  Full Name *
                </label>
                <input
                  type="text"
                  id="name"
                  name="name"
                  required
                  class="w-full px-4 py-3 bg-bg-tertiary border border-border text-text-primary placeholder:text-text-muted focus:border-accent-cyan focus:ring-1 focus:ring-accent-cyan outline-none transition"
                  placeholder="John Smith"
                />
              </div>
              <div>
                <label for="company" class="block font-mono text-xs text-text-muted uppercase tracking-wider mb-2">
                  Company Name
                </label>
                <input
                  type="text"
                  id="company"
                  name="company"
                  class="w-full px-4 py-3 bg-bg-tertiary border border-border text-text-primary placeholder:text-text-muted focus:border-accent-cyan focus:ring-1 focus:ring-accent-cyan outline-none transition"
                  placeholder="ABC Electronics Inc."
                />
              </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
              <div>
                <label for="email" class="block font-mono text-xs text-text-muted uppercase tracking-wider mb-2">
                  Email Address *
                </label>
                <input
                  type="email"
                  id="email"
                  name="email"
                  required
                  class="w-full px-4 py-3 bg-bg-tertiary border border-border text-text-primary placeholder:text-text-muted focus:border-accent-cyan focus:ring-1 focus:ring-accent-cyan outline-none transition"
                  placeholder="john@company.com"
                />
              </div>
              <div>
                <label for="phone" class="block font-mono text-xs text-text-muted uppercase tracking-wider mb-2">
                  Phone Number
                </label>
                <input
                  type="tel"
                  id="phone"
                  name="phone"
                  class="w-full px-4 py-3 bg-bg-tertiary border border-border text-text-primary placeholder:text-text-muted focus:border-accent-cyan focus:ring-1 focus:ring-accent-cyan outline-none transition"
                  placeholder="+1 (555) 000-0000"
                />
              </div>
            </div>

            <div class="mb-6">
              <label for="connector" class="block font-mono text-xs text-text-muted uppercase tracking-wider mb-2">
                Connector Series / Type
              </label>
              <input
                type="text"
                id="connector"
                name="connector"
                class="w-full px-4 py-3 bg-bg-tertiary border border-border text-text-primary placeholder:text-text-muted focus:border-accent-cyan focus:ring-1 focus:ring-accent-cyan outline-none transition"
                placeholder="e.g., JST PH 2.0mm, Custom, Not sure"
              />
            </div>

            <div class="mb-6">
              <label for="quantity" class="block font-mono text-xs text-text-muted uppercase tracking-wider mb-2">
                Estimated Annual Quantity
              </label>
              <select
                id="quantity"
                name="quantity"
                class="w-full px-4 py-3 bg-bg-tertiary border border-border text-text-primary focus:border-accent-cyan focus:ring-1 focus:ring-accent-cyan outline-none transition"
              >
                <option value="">Select quantity range</option>
                <option value="prototype">Prototype (1-100 units)</option>
                <option value="low-volume">Low Volume (100-1K units)</option>
                <option value="medium-volume">Medium Volume (1K-10K units)</option>
                <option value="high-volume">High Volume (10K+ units)</option>
              </select>
            </div>

            <div class="mb-6">
              <label for="message" class="block font-mono text-xs text-text-muted uppercase tracking-wider mb-2">
                Project Specifications *
              </label>
              <textarea
                id="message"
                name="message"
                rows="6"
                required
                class="w-full px-4 py-3 bg-bg-tertiary border border-border text-text-primary placeholder:text-text-muted focus:border-accent-cyan focus:ring-1 focus:ring-accent-cyan outline-none transition resize-none"
                placeholder="Describe your project requirements including connector types, wire gauges, cable lengths, termination types, and any special requirements..."
              ></textarea>
            </div>

            <div class="mb-6">
              <label for="files" class="block font-mono text-xs text-accent-amber uppercase tracking-wider mb-2">
                üìé Upload Assembly Drawing (PDF, DXF, STEP)
              </label>
              <div class="border-2 border-dashed border-border hover:border-accent-cyan/50 transition-colors p-6 text-center bg-bg-tertiary">
                <input
                  type="file"
                  id="files"
                  name="files"
                  multiple
                  accept=".pdf,.dxf,.dwg,.step,.stp,.iges,.igs,.jpg,.png"
                  class="w-full text-text-muted file:mr-4 file:py-2 file:px-4 file:rounded-none file:border-0 file:text-sm file:font-mono file:bg-bg-secondary file:text-accent-cyan hover:file:bg-accent-cyan/10 cursor-pointer"
                  required
                />
                <p class="font-mono text-xs text-text-muted mt-3">
                  Drag & drop or click to upload
                </p>
                <p class="font-mono text-xs text-text-muted mt-1">
                  Accepted: PDF, DXF, DWG, STEP, IGES, JPG, PNG
                </p>
                <p class="font-mono text-xs text-accent-amber mt-2">
                  ‚ö†Ô∏è Maximum file size: 10MB per file
                </p>
              </div>
            </div>

            <!-- Cloudflare Turnstile CAPTCHA -->
            {enableTurnstile && (
              <div class="mb-6">
                <div class="cf-turnstile" data-sitekey={turnstileSiteKey}></div>
                <p class="font-mono text-xs text-text-muted mt-2">
                  Protected by Cloudflare Turnstile
                </p>
              </div>
            )}

            <!-- File Validation Status -->
            <div id="file-validation-status" class="mb-4 hidden">
              <div class="bg-red-500/10 border border-red-500/30 text-red-500 px-4 py-3 text-sm"></div>
            </div>

            <button
              type="submit"
              class="w-full px-8 py-4 font-mono text-sm font-bold uppercase tracking-widest text-bg-primary bg-accent-cyan hover:bg-accent-green transition-all duration-300 hover:-translate-y-0.5 hover:shadow-lg hover:shadow-accent-green/30"
              id="submit-btn"
            >
              Send Inquiry
            </button>
          </form>
        </div>

        <!-- File Validation Script -->
        <script define:vars={{ MAX_SIZE: 10 * 1024 * 1024, ALLOWED_TYPES: ['.pdf', '.dxf', '.dwg', '.step', '.stp', '.iges', '.igs', '.jpg', '.png'] }}>
          const fileInput = document.getElementById('files');
          const submitBtn = document.getElementById('submit-btn');
          const statusDiv = document.getElementById('file-validation-status');

          function showStatus(message, isError = true) {
            statusDiv.classList.remove('hidden');
            const statusBox = statusDiv.querySelector('div');
            statusBox.textContent = message;
            statusBox.className = isError
              ? 'bg-red-500/10 border border-red-500/30 text-red-500 px-4 py-3 text-sm'
              : 'bg-green-500/10 border border-green-500/30 text-green-500 px-4 py-3 text-sm';
          }

          function hideStatus() {
            statusDiv.classList.add('hidden');
          }

          function validateFile(file) {
            // Check file size
            if (file.size > MAX_SIZE) {
              const sizeMB = (file.size / (1024 * 1024)).toFixed(2);
              return {
                valid: false,
                message: `File "${file.name}" (${sizeMB}MB) exceeds 10MB limit. Please compress the file or contact our technical team.`
              };
            }

            // Check file extension
            const fileName = file.name.toLowerCase();
            const hasValidExtension = ALLOWED_TYPES.some(ext => fileName.endsWith(ext));

            if (!hasValidExtension) {
              return {
                valid: false,
                message: `File "${file.name}" format not supported. Please use: PDF, DXF, DWG, STEP, IGES, JPG, PNG`
              };
            }

            return { valid: true };
          }

          fileInput.addEventListener('change', (e) => {
            hideStatus();
            const files = Array.from(e.target.files);

            if (files.length === 0) {
              return;
            }

            // Validate all files
            for (const file of files) {
              const result = validateFile(file);
              if (!result.valid) {
                showStatus(result.message, true);
                submitBtn.disabled = true;
                fileInput.value = '';
                return;
              }
            }

            // All files valid
            if (files.length > 0) {
              showStatus(`‚úì ${files.length} file(s) selected, total ${(files.reduce((sum, f) => sum + f.size, 0) / (1024 * 1024)).toFixed(2)}MB`, false);
              submitBtn.disabled = false;
            }
          });

          // Validate again before form submission
          const form = document.querySelector('form');
          form.addEventListener('submit', (e) => {
            // Validate files
            const files = Array.from(fileInput.files);

            for (const file of files) {
              const result = validateFile(file);
              if (!result.valid) {
                e.preventDefault();
                showStatus(result.message, true);
                return false;
              }
            }

            // Validate Turnstile (if enabled)
            const turnstileResponse = document.querySelector('input[name="cf-turnstile-response"]');
            if (turnstileResponse && (!turnstileResponse.value || turnstileResponse.value === '')) {
              e.preventDefault();
              showStatus('Please complete the verification before submitting.', true);
              return false;
            }
          });
        </script>
      </form>
      </div>

      <!-- Contact Info Cards -->
      <div class="max-w-4xl mx-auto">
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
          <!-- Direct Contact -->
          <div class="bg-bg-secondary/60 backdrop-blur border border-border p-6 hover:border-accent-cyan/30 transition-all duration-300 hover:-translate-y-1">
            <div class="flex items-center gap-3 mb-4">
              <div class="w-10 h-10 bg-accent-cyan/10 border border-accent-cyan/30 flex items-center justify-center">
                <svg class="w-5 h-5 text-accent-cyan" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
                </svg>
              </div>
              <h3 class="font-mono text-xs font-bold uppercase tracking-widest text-accent-cyan">Contact</h3>
            </div>
            <div class="space-y-3">
              <a href={`mailto:${contactEmail}`} class="block text-sm text-text-primary hover:text-accent-cyan transition group">
                <div class="font-mono text-xs text-text-muted mb-0.5">Email</div>
                <div class="flex items-center gap-2">
                  <span>{contactEmail}</span>
                  <span class="opacity-0 group-hover:opacity-100 transition-opacity">‚Üí</span>
                </div>
              </a>
              <a href="tel:+8618928435743" class="block text-sm text-text-primary hover:text-accent-cyan transition group">
                <div class="font-mono text-xs text-text-muted mb-0.5">Phone</div>
                <div class="flex items-center gap-2">
                  <span>+86 189-2843-5743</span>
                  <span class="opacity-0 group-hover:opacity-100 transition-opacity">‚Üí</span>
                </div>
              </a>
              <a href="https://wa.me/8618928435743" class="block text-sm text-text-primary hover:text-accent-cyan transition group">
                <div class="font-mono text-xs text-text-muted mb-0.5">WhatsApp</div>
                <div class="flex items-center gap-2">
                  <span>+86 189-2843-5743</span>
                  <span class="opacity-0 group-hover:opacity-100 transition-opacity">‚Üí</span>
                </div>
              </a>
            </div>
          </div>

          <!-- Business Hours -->
          <div class="bg-bg-secondary/60 backdrop-blur border border-border p-6 hover:border-accent-cyan/30 transition-all duration-300 hover:-translate-y-1">
            <div class="flex items-center gap-3 mb-4">
              <div class="w-10 h-10 bg-accent-cyan/10 border border-accent-cyan/30 flex items-center justify-center">
                <svg class="w-5 h-5 text-accent-cyan" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
              </div>
              <h3 class="font-mono text-xs font-bold uppercase tracking-widest text-accent-cyan">Hours</h3>
            </div>
            <div class="space-y-2.5 text-sm">
              <div>
                <div class="text-text-secondary mb-1">Monday - Friday</div>
                <div class="font-mono text-accent-cyan">9:00 AM - 6:00 PM</div>
              </div>
              <div>
                <div class="text-text-secondary mb-1">Saturday</div>
                <div class="font-mono text-accent-cyan">10:00 AM - 4:00 PM</div>
              </div>
              <div>
                <div class="text-text-secondary mb-1">Sunday</div>
                <div class="font-mono text-text-muted">Closed</div>
              </div>
            </div>
          </div>

          <!-- Quick Response -->
          <div class="bg-bg-secondary/60 backdrop-blur border border-border p-6 hover:border-accent-cyan/30 transition-all duration-300 hover:-translate-y-1">
            <div class="flex items-center gap-3 mb-4">
              <div class="w-10 h-10 bg-accent-green/10 border border-accent-green/30 flex items-center justify-center">
                <svg class="w-5 h-5 text-accent-green" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                </svg>
              </div>
              <h3 class="font-mono text-xs font-bold uppercase tracking-widest text-accent-green">Why Us</h3>
            </div>
            <ul class="space-y-2 text-sm text-text-secondary">
              <li class="flex items-start gap-2">
                <span class="text-accent-green flex-shrink-0 mt-0.5">
                  <svg class="w-3.5 h-3.5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                  </svg>
                </span>
                <span>24-Hour Quote Response</span>
              </li>
              <li class="flex items-start gap-2">
                <span class="text-accent-green flex-shrink-0 mt-0.5">
                  <svg class="w-3.5 h-3.5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                  </svg>
                </span>
                <span>Engineering Support</span>
              </li>
              <li class="flex items-start gap-2">
                <span class="text-accent-green flex-shrink-0 mt-0.5">
                  <svg class="w-3.5 h-3.5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                  </svg>
                </span>
                <span>Free Design Review</span>
              </li>
              <li class="flex items-start gap-2">
                <span class="text-accent-green flex-shrink-0 mt-0.5">
                  <svg class="w-3.5 h-3.5" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                  </svg>
                </span>
                <span>48-Hour Prototypes</span>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Load Cloudflare Turnstile Script (if enabled) - must load after DOM is ready -->
  {enableTurnstile && (
    <script src="https://challenges.cloudflare.com/turnstile/v0/api.js" defer></script>
  )}
</MainLayout>
