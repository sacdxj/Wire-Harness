---
import MainLayout from '../layouts/MainLayout.astro';
import Breadcrumb from '../components/Breadcrumb.astro';

const breadcrumbItems = [
  { name: 'Home', href: '/' },
  { name: 'Contact', href: '/contact' }
];

// ä»ç¯å¢ƒå˜é‡è·å–é…ç½®
const formspreeId = import.meta.env.VITE_FORMSPREE_ID || 'mpqjalap';
const contactEmail = import.meta.env.VITE_CONTACT_EMAIL || 'Gben@trycay.com';
const contactPhone = import.meta.env.VITE_CONTACT_PHONE || '+8618928435743';
const turnstileSiteKey = import.meta.env.VITE_TURNSTILE_SITE_KEY || '';
const enableTurnstile = !!turnstileSiteKey;
---

<MainLayout
  title="Request Terminal Wire Assembly Quote | Upload Drawings"
  description="Get a custom terminal wire assembly quote within 24 hours. Upload your drawings, specifications, and connector requirements for rapid prototyping and volume production."
>
  <!-- Contact Page Schema -->
  <script type="application/ld+json" set:html={JSON.stringify({
    "@context": "https://schema.org",
    "@type": "ContactPage",
    "name": "Contact Trycay - Request Wire Assembly Quote",
    "description": "Get a custom terminal wire assembly quote within 24 hours",
    "mainEntity": {
      "@type": "Organization",
      "name": "Trycay",
      "url": "https://trycay.com",
      "contactPoint": [
        {
          "@type": "ContactPoint",
          "contactType": "sales",
          "email": contactEmail,
          "availableLanguage": ["English", "Chinese"],
          "contactOption": "TollFree"
        },
        {
          "@type": "ContactPoint",
          "contactType": "customer service",
          "telephone": "+86-189-2843-5743",
          "availableLanguage": ["English", "Chinese"],
          "contactOption": "TollFree"
        },
        {
          "@type": "ContactPoint",
          "contactType": "technical support",
          "email": contactEmail,
          "availableLanguage": ["English", "Chinese"]
        }
      ],
      "address": {
        "@type": "PostalAddress",
        "addressCountry": "CN",
        "addressRegion": "Guangdong"
      }
    },
    "about": {
      "@type": "Service",
      "name": "Custom Wire Assembly Quote Service",
      "description": "Request quotes for custom terminal wire assemblies, rapid prototyping, and volume production",
      "provider": {
        "@type": "Organization",
        "name": "Trycay",
        "url": "https://trycay.com"
      }
    }
  })} />

  <Breadcrumb items={breadcrumbItems} />

  <section class="px-4 py-16">
    <div class="max-w-4xl mx-auto">
      <!-- Hero Image -->
      <div class="mb-12 rounded-lg overflow-hidden border border-border">
        <img
          src="/images/contact/customer-service.jpg"
          alt="Engineering Support Team"
          class="w-full h-64 object-cover"
          loading="lazy"
        />
      </div>

      <div class="text-center mb-12">
        <p class="font-mono text-xs text-accent-cyan uppercase tracking-widest mb-4">Get a Quote</p>
        <h1 class="text-4xl md:text-5xl font-bold tracking-tight mb-4">Upload Your Assembly Drawing</h1>
        <p class="text-lg text-text-secondary">
          Share your terminal wire assembly specifications. Our engineering team will respond within 24 hours with pricing and lead time.
        </p>
      </div>

      <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
        <!-- Contact Form -->
        <div class="lg:col-span-2">
          <form
            action={`https://formspree.io/f/${formspreeId}`}
            method="POST"
            class="bg-bg-secondary border border-border p-8"
          >
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
              <div>
                <label for="name" class="block font-mono text-xs text-text-muted uppercase tracking-wider mb-2">
                  Full Name *
                </label>
                <input
                  type="text"
                  id="name"
                  name="name"
                  required
                  class="w-full px-4 py-3 bg-bg-tertiary border border-border text-text-primary placeholder:text-text-muted focus:border-accent-cyan focus:ring-1 focus:ring-accent-cyan outline-none transition"
                  placeholder="John Smith"
                />
              </div>
              <div>
                <label for="company" class="block font-mono text-xs text-text-muted uppercase tracking-wider mb-2">
                  Company Name
                </label>
                <input
                  type="text"
                  id="company"
                  name="company"
                  class="w-full px-4 py-3 bg-bg-tertiary border border-border text-text-primary placeholder:text-text-muted focus:border-accent-cyan focus:ring-1 focus:ring-accent-cyan outline-none transition"
                  placeholder="ABC Electronics Inc."
                />
              </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
              <div>
                <label for="email" class="block font-mono text-xs text-text-muted uppercase tracking-wider mb-2">
                  Email Address *
                </label>
                <input
                  type="email"
                  id="email"
                  name="email"
                  required
                  class="w-full px-4 py-3 bg-bg-tertiary border border-border text-text-primary placeholder:text-text-muted focus:border-accent-cyan focus:ring-1 focus:ring-accent-cyan outline-none transition"
                  placeholder="john@company.com"
                />
              </div>
              <div>
                <label for="phone" class="block font-mono text-xs text-text-muted uppercase tracking-wider mb-2">
                  Phone Number
                </label>
                <input
                  type="tel"
                  id="phone"
                  name="phone"
                  class="w-full px-4 py-3 bg-bg-tertiary border border-border text-text-primary placeholder:text-text-muted focus:border-accent-cyan focus:ring-1 focus:ring-accent-cyan outline-none transition"
                  placeholder="+1 (555) 000-0000"
                />
              </div>
            </div>

            <div class="mb-6">
              <label for="connector" class="block font-mono text-xs text-text-muted uppercase tracking-wider mb-2">
                Connector Series / Type
              </label>
              <input
                type="text"
                id="connector"
                name="connector"
                class="w-full px-4 py-3 bg-bg-tertiary border border-border text-text-primary placeholder:text-text-muted focus:border-accent-cyan focus:ring-1 focus:ring-accent-cyan outline-none transition"
                placeholder="e.g., JST PH 2.0mm, Custom, Not sure"
              />
            </div>

            <div class="mb-6">
              <label for="quantity" class="block font-mono text-xs text-text-muted uppercase tracking-wider mb-2">
                Estimated Annual Quantity
              </label>
              <select
                id="quantity"
                name="quantity"
                class="w-full px-4 py-3 bg-bg-tertiary border border-border text-text-primary focus:border-accent-cyan focus:ring-1 focus:ring-accent-cyan outline-none transition"
              >
                <option value="">Select quantity range</option>
                <option value="prototype">Prototype (1-100 units)</option>
                <option value="low-volume">Low Volume (100-1K units)</option>
                <option value="medium-volume">Medium Volume (1K-10K units)</option>
                <option value="high-volume">High Volume (10K+ units)</option>
              </select>
            </div>

            <div class="mb-6">
              <label for="message" class="block font-mono text-xs text-text-muted uppercase tracking-wider mb-2">
                Project Specifications *
              </label>
              <textarea
                id="message"
                name="message"
                rows="6"
                required
                class="w-full px-4 py-3 bg-bg-tertiary border border-border text-text-primary placeholder:text-text-muted focus:border-accent-cyan focus:ring-1 focus:ring-accent-cyan outline-none transition resize-none"
                placeholder="Describe your project requirements including connector types, wire gauges, cable lengths, termination types, and any special requirements..."
              ></textarea>
            </div>

            <div class="mb-6">
              <label for="files" class="block font-mono text-xs text-accent-amber uppercase tracking-wider mb-2">
                ğŸ“ Upload Assembly Drawing (PDF, DXF, STEP)
              </label>
              <div class="border-2 border-dashed border-border hover:border-accent-cyan/50 transition-colors p-6 text-center bg-bg-tertiary">
                <input
                  type="file"
                  id="files"
                  name="files"
                  multiple
                  accept=".pdf,.dxf,.dwg,.step,.stp,.iges,.igs,.jpg,.png"
                  class="w-full text-text-muted file:mr-4 file:py-2 file:px-4 file:rounded-none file:border-0 file:text-sm file:font-mono file:bg-bg-secondary file:text-accent-cyan hover:file:bg-accent-cyan/10 cursor-pointer"
                  required
                />
                <p class="font-mono text-xs text-text-muted mt-3">
                  Drag & drop or click to upload
                </p>
                <p class="font-mono text-xs text-text-muted mt-1">
                  Accepted: PDF, DXF, DWG, STEP, IGES, JPG, PNG
                </p>
                <p class="font-mono text-xs text-accent-amber mt-2">
                  âš ï¸ Maximum file size: 10MB per file
                </p>
              </div>
            </div>

            <!-- Cloudflare Turnstile CAPTCHA -->
            {enableTurnstile && (
              <div class="mb-6">
                <div class="cf-turnstile" data-sitekey={turnstileSiteKey}></div>
                <p class="font-mono text-xs text-text-muted mt-2">
                  Protected by Cloudflare Turnstile
                </p>
              </div>
            )}

            <!-- File Validation Status -->
            <div id="file-validation-status" class="mb-4 hidden">
              <div class="bg-red-500/10 border border-red-500/30 text-red-500 px-4 py-3 text-sm"></div>
            </div>

            <button
              type="submit"
              class="w-full px-8 py-4 font-mono text-sm font-bold uppercase tracking-widest text-bg-primary bg-accent-cyan hover:bg-accent-green transition-all duration-300 hover:-translate-y-0.5 hover:shadow-lg hover:shadow-accent-green/30"
              id="submit-btn"
            >
              Send Inquiry
            </button>
          </form>
        </div>

        <!-- File Validation Script -->
        <script define:vars={{ MAX_SIZE: 10 * 1024 * 1024, ALLOWED_TYPES: ['.pdf', '.dxf', '.dwg', '.step', '.stp', '.iges', '.igs', '.jpg', '.png'] }}>
          const fileInput = document.getElementById('files');
          const submitBtn = document.getElementById('submit-btn');
          const statusDiv = document.getElementById('file-validation-status');

          function showStatus(message, isError = true) {
            statusDiv.classList.remove('hidden');
            const statusBox = statusDiv.querySelector('div');
            statusBox.textContent = message;
            statusBox.className = isError
              ? 'bg-red-500/10 border border-red-500/30 text-red-500 px-4 py-3 text-sm'
              : 'bg-green-500/10 border border-green-500/30 text-green-500 px-4 py-3 text-sm';
          }

          function hideStatus() {
            statusDiv.classList.add('hidden');
          }

          function validateFile(file) {
            // æ£€æŸ¥æ–‡ä»¶å¤§å°
            if (file.size > MAX_SIZE) {
              const sizeMB = (file.size / (1024 * 1024)).toFixed(2);
              return {
                valid: false,
                message: `æ–‡ä»¶ "${file.name}" (${sizeMB}MB) è¶…è¿‡ 10MB é™åˆ¶ã€‚è¯·å‹ç¼©æ–‡ä»¶æˆ–è”ç³»æˆ‘ä»¬çš„æŠ€æœ¯å›¢é˜Ÿã€‚`
              };
            }

            // æ£€æŸ¥æ–‡ä»¶æ‰©å±•å
            const fileName = file.name.toLowerCase();
            const hasValidExtension = ALLOWED_TYPES.some(ext => fileName.endsWith(ext));

            if (!hasValidExtension) {
              return {
                valid: false,
                message: `æ–‡ä»¶ "${file.name}" æ ¼å¼ä¸æ”¯æŒã€‚è¯·ä½¿ç”¨: PDF, DXF, DWG, STEP, IGES, JPG, PNG`
              };
            }

            return { valid: true };
          }

          fileInput.addEventListener('change', (e) => {
            hideStatus();
            const files = Array.from(e.target.files);

            if (files.length === 0) {
              return;
            }

            // éªŒè¯æ‰€æœ‰æ–‡ä»¶
            for (const file of files) {
              const result = validateFile(file);
              if (!result.valid) {
                showStatus(result.message, true);
                submitBtn.disabled = true;
                fileInput.value = '';
                return;
              }
            }

            // æ‰€æœ‰æ–‡ä»¶æœ‰æ•ˆ
            if (files.length > 0) {
              showStatus(`âœ“ å·²é€‰æ‹© ${files.length} ä¸ªæ–‡ä»¶ï¼Œæ€»è®¡ ${(files.reduce((sum, f) => sum + f.size, 0) / (1024 * 1024)).toFixed(2)}MB`, false);
              submitBtn.disabled = false;
            }
          });

          // è¡¨å•æäº¤å‰å†æ¬¡éªŒè¯
          const form = document.querySelector('form');
          form.addEventListener('submit', (e) => {
            // éªŒè¯æ–‡ä»¶
            const files = Array.from(fileInput.files);

            for (const file of files) {
              const result = validateFile(file);
              if (!result.valid) {
                e.preventDefault();
                showStatus(result.message, true);
                return false;
              }
            }

            // éªŒè¯ Turnstileï¼ˆå¦‚æœå¯ç”¨ï¼‰
            const turnstileResponse = document.querySelector('input[name="cf-turnstile-response"]');
            if (turnstileResponse && (!turnstileResponse.value || turnstileResponse.value === '')) {
              e.preventDefault();
              showStatus('è¯·å®ŒæˆäººæœºéªŒè¯åå†æäº¤è¡¨å•ã€‚Please complete the verification before submitting.', true);
              return false;
            }
          });
        </script>

        <!-- Load Cloudflare Turnstile Script (if enabled) -->
        {enableTurnstile && (
          <script src="https://challenges.cloudflare.com/turnstile/v0/api.js" async defer></script>
        )}
        </div>

        <!-- Contact Info -->
        <div class="space-y-6">
          <div class="bg-bg-secondary border border-border p-6">
            <h3 class="font-mono text-xs font-bold uppercase tracking-widest text-accent-cyan mb-4">Direct Contact</h3>
            <div class="space-y-4">
              <div>
                <p class="font-mono text-xs text-text-muted uppercase tracking-wider mb-1">Email</p>
                <a href={`mailto:${contactEmail}`} class="text-text-primary hover:text-accent-cyan transition">
                  {contactEmail}
                </a>
              </div>
              <div>
                <p class="font-mono text-xs text-text-muted uppercase tracking-wider mb-1">Phone</p>
                <a href="tel:+8618928435743" class="text-text-primary hover:text-accent-cyan transition">
                  +86 189-2843-5743
                </a>
              </div>
              <div>
                <p class="font-mono text-xs text-text-muted uppercase tracking-wider mb-1">WhatsApp</p>
                <a href="https://wa.me/8618928435743" class="text-text-primary hover:text-accent-cyan transition">
                  +86 189-2843-5743
                </a>
              </div>
            </div>
          </div>

          <div class="bg-bg-secondary border border-border p-6">
            <h3 class="font-mono text-xs font-bold uppercase tracking-widest text-accent-cyan mb-4">Business Hours</h3>
            <div class="space-y-2 text-sm">
              <div class="flex justify-between">
                <span class="text-text-secondary">Monday - Friday</span>
                <span class="font-mono">9:00 AM - 6:00 PM CST</span>
              </div>
              <div class="flex justify-between">
                <span class="text-text-secondary">Saturday</span>
                <span class="font-mono">10:00 AM - 4:00 PM CST</span>
              </div>
              <div class="flex justify-between">
                <span class="text-text-secondary">Sunday</span>
                <span class="font-mono">Closed</span>
              </div>
            </div>
          </div>

          <div class="bg-bg-secondary border border-border p-6">
            <h3 class="font-mono text-xs font-bold uppercase tracking-widest text-accent-cyan mb-4">Quick Response</h3>
            <ul class="space-y-2 text-sm text-text-secondary">
              <li class="flex items-start gap-2">
                <span class="text-accent-green">âœ“</span>
                <span>Quote within 24 hours</span>
              </li>
              <li class="flex items-start gap-2">
                <span class="text-accent-green">âœ“</span>
                <span>Engineering support</span>
              </li>
              <li class="flex items-start gap-2">
                <span class="text-accent-green">âœ“</span>
                <span>Free design review</span>
              </li>
              <li class="flex items-start gap-2">
                <span class="text-accent-green">âœ“</span>
                <span>48-hour prototypes</span>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </section>
</MainLayout>
