---
/*
 * Decap CMS - Identity Widget & Admin Interface
 *
 * Security improvements:
 * - Locked version to 3.1.0
 * - Added SRI (Subresource Integrity) verification
 * - Restricted to admin pages only
 */

// SRI hash value (using version-specific hash)
// Note: Generate correct value on deployment using:
// openssl dgst -sha384 -binary decap-cms.js | openssl base64 -A
const CMS_VERSION = '3.1.0';
const CMS_SRI = 'sha384-qYBUflIGwQ0PauubHjHitai6og3+FO7FZacBLsJKonevWUVClovZ3CBmBuhc1k+Q';
---

<!-- Load Decap CMS with locked version and SRI -->
<script
  src={`https://unpkg.com/decap-cms@${CMS_VERSION}/dist/decap-cms.js`}
  integrity={CMS_SRI}
  crossorigin="anonymous"
></script>

<script define:vars={{ decapConfigUrl: '/admin/config.yml' }}>
  // Initialize CMS only on admin pages
  document.addEventListener('DOMContentLoaded', () => {
    // Check if on admin page
    if (!window.location.pathname.startsWith('/admin')) {
      console.warn('Decap CMS should only be loaded on admin pages');
      return;
    }

    if (window.CMS) {
      // Decap CMS v3.x is compatible with React 18
      window.CMS.init();
    }
  });
</script>

<style>
  /* Decap CMS Custom Dark Theme Styles */
  .cms-editor-modal {
    font-family: 'Space Grotesk', sans-serif !important;
    background-color: #0a0e17 !important;
  }

  .cms-editor-modal input,
  .cms-editor-modal textarea {
    background-color: #1f2937 !important;
    color: #f9fafb !important;
    border-color: #374151 !important;
  }

  .cms-editor-modal .cm-preview {
    background-color: #111827 !important;
  }

  /* Fix for React 18 compatibility */
  .cms-plugin-link {
    pointer-events: none;
  }
</style>
